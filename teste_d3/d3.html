<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gráfico de Dispersão com D3.js</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.min.js"></script>

  <style>
    
  </style>

</head>
<body>

  
  <svg width="800" height="600"></svg>

  <script>
    // Carregar o arquivo CSV
    d3.csv("../projecao_multidimensional/output/Saida_ISOMAP.csv").then(function(data) {
      
      // Converter valores de v1 e v2 para números
      data.forEach(function(d) {
        d.v1 = +d.v1;
        d.v2 = +d.v2;
      });
      
      // Definir margens e dimensões do gráfico
      var margin = {top: 20, right: 20, bottom: 30, left: 40},
          width = 800 - margin.left - margin.right,
          height = 600 - margin.top - margin.bottom;

      // Definir escala x
      var x = d3.scaleLinear()
          .domain(d3.extent(data, function(d) { return d.v1; }))
          .range([0, width]);

      // Definir escala y
      var y = d3.scaleLinear()
          .domain(d3.extent(data, function(d) { return d.v2; }))
          .range([height, 0]);

      // Definir escala de cores para a classe
      var color = d3.scaleOrdinal(d3.schemeCategory10);

      // Criar elemento SVG
      var svg = d3.select("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

      // Adicionar círculos
      svg.selectAll("circle")
          .data(data)
        .enter().append("circle")
          .attr("cx", function(d) { return x(d.v1); })
          .attr("cy", function(d) { return y(d.v2); })
          .attr("r", 5) // Raio do círculo
          .style("fill", function(d) { return color(d.class); })
          .on("mouseover", function(event, d) {
            // Mostrar rótulo ao passar o mouse sobre o círculo
            var tooltip = svg.append("g")
              .attr("class", "tooltip");

              var text = tooltip.append("text")
              .attr("x", x(d.v1) + 10)
              .attr("y", y(d.v2) - 10)
              .text(d.id+" "+d.class);

            var bbox = text.node().getBBox(); // Obtém a caixa delimitadora do texto
            var padding = 5; // Espaçamento entre o texto e a borda do retângulo

            tooltip.insert("rect", "text") // Insere o retângulo antes do texto
              .attr("x", bbox.x - padding)
              .attr("y", bbox.y - padding)
              .attr("width", bbox.width + 2 * padding)
              .attr("height", bbox.height + 2 * padding)
              .style("fill", "lightgray")
              .style("stroke", "black");
          })
          .on("mouseout", function() {
            // Remover rótulo ao retirar o mouse do círculo
            d3.selectAll(".tooltip").remove();
          });
          

      
      // Adicionar eixos
      svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

      svg.append("g")
          .call(d3.axisLeft(y));

    }).catch(function(error) {
      console.log("Erro ao carregar os dados: " + error);
    });
  </script>
</body>
</html>
